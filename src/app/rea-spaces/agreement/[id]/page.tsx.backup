"use client"

import { useEffect, useState, useCallback } from "react"
import { useRouter, useParams } from "next/navigation"
import { useAuth } from "@/features/auth/hooks/useAuth"
import { spaceService } from "@/features/spaces/services/space.service"
import { contractService } from "@/features/contracts/services/contract.service"
import { assetService } from "@/features/assets/services/asset.service"
import { Button } from "@/shared/components/ui/Button"
import {
  AssetTypeEnum,
  AssetOwnerEnum,
  Space,
  SpaceStatus,
} from "@/shared/types"
import jsPDF from "jspdf"
import styles from "./page.module.css"

export default function AgreementPage() {
  const router = useRouter()
  const params = useParams()
  const { user, isLoading: authLoading } = useAuth()
  const [space, setSpace] = useState<Space | null>(null)
  const [contractDocumentId, setContractDocumentId] = useState<number | null>(
    null,
  )
  const [contractDocumentUrl, setContractDocumentUrl] = useState<string | null>(
    null,
  )
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [isLoadingSpace, setIsLoadingSpace] = useState(true)
  const [isGeneratingDocument, setIsGeneratingDocument] = useState(false)
  const [isAccepted, setIsAccepted] = useState(false)
  const [isCompleted, setIsCompleted] = useState(false)

  const spaceId = params?.id ? Number(params.id) : null

  const loadSpace = useCallback(async () => {
    try {
      setIsLoadingSpace(true)
      const spaceData = await spaceService.getSpaceById(spaceId!)
      setSpace(spaceData)
    } catch (error) {
      console.error("Error al cargar espacio:", error)
      alert("Error al cargar la informaci√≥n del espacio")
    } finally {
      setIsLoadingSpace(false)
    }
  }, [spaceId])

  useEffect(() => {
    if (!authLoading && !user) {
      router.push("/login")
      return
    }

    if (spaceId) {
      loadSpace()
    }
  }, [authLoading, user, spaceId, router, loadSpace])

  const loadLogo = async (path: string, width = 120, height = 60) => {
    try {
      const res = await fetch(path)
      if (!res.ok) return null
      const buffer = await res.arrayBuffer()
      return new ImageRun({
        data: buffer,
        type: "png",
        transformation: {
          width,
          height,
        },
      })
    } catch (error) {
      console.warn("No se pudo cargar logo", path, error)
      return null
    }
  }

  const buildContractDoc = async (currentDate: string) => {
    if (!space) return null

    const twoYearsFromNow = new Date()
    twoYearsFromNow.setFullYear(twoYearsFromNow.getFullYear() + 2)

    const [iccaLogo, reaLogo] = await Promise.all([
      loadLogo("/logos/icca.png"),
      loadLogo("/logos/rea.png"),
    ])

    return new Document({
      sections: [
        {
          properties: {},
          children: [
            new Paragraph({
              children: [
                iccaLogo || new TextRun({ text: "ICCA", bold: true }),
                new TextRun({ text: "\t" }),
                reaLogo || new TextRun({ text: "REA", bold: true }),
              ],
              tabStops: [
                {
                  type: TabStopType.RIGHT,
                  position: 9000,
                },
              ],
            }),
            new Paragraph({
              text: "CARTA COMPROMISO PARA FORMAR PARTE DE LA RED DE ESPACIOS AUDIOVISUALES (REA)",
              heading: HeadingLevel.HEADING_1,
              alignment: AlignmentType.CENTER,
              spacing: { after: 300 },
            }),
            new Paragraph({
              text: `Yo, ${space.managerName} en representaci√≥n del espacio ${space.name}, en adelante ‚ÄúMIEMBRO DE LA REA‚Äù.`,
              spacing: { after: 300 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            new Paragraph({
              text: "Para efectos de la presente carta compromiso me comprometo con la Red de Espacios Audiovisuales (REA) a cumplir con cada una de las obligaciones y acepto la totalidad de los t√©rminos y condiciones de uso del Banco de Contenidos Audiovisuales gestionado por el INSTITUTO DE CINE Y CREACI√ìN AUDIOVISUAL (ICCA).",
              spacing: { after: 200 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            new Paragraph({
              text: "El objeto de este documento es establecer mi compromiso ante el cumplimiento de las obligaciones y prohibiciones relativas a mi membres√≠a, as√≠ como al acceso de obras, a trav√©s del Banco de Contenidos Audiovisuales.",
              spacing: { after: 300 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            new Paragraph({
              text: "I. OBLIGACIONES Y PROHIBICIONES:",
              heading: HeadingLevel.HEADING_2,
              spacing: { before: 200, after: 150 },
            }),
            new Paragraph({
              text: "El miembro de la Red de Espacios Audiovisuales se obliga a:",
              spacing: { after: 100 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            ...[
              "Remitir los reportes de exhibici√≥n y taquilla √∫nicamente respecto de las funciones realizadas con obras obtenidas a trav√©s del Banco de Contenidos Audiovisuales.",
              "Mantener en funcionamiento el equipamiento t√©cnico utilizado para la exhibici√≥n, garantizando condiciones adecuadas de audio, imagen y seguridad.",
              "Respetar los derechos de autor y conexos, as√≠ como las condiciones de uso y reproducci√≥n de obras provenientes del Banco de Contenidos Audiovisuales.",
              "Permitir visitas t√©cnicas y program√°ticas realizadas por el ICCA, cuando √©stas sean necesarias para verificar el cumplimiento de este Reglamento.",
              "Actualizar la informaci√≥n administrativa y t√©cnica cuando se produzcan cambios o sean solicitados por el ICCA, en la administraci√≥n, equipamiento, funcionamiento o caracter√≠sticas del espacio.",
              "Garantizar accesibilidad para el p√∫blico, conforme a la normativa vigente.",
              "Participar, cuando corresponda, en actividades de formaci√≥n de p√∫blicos, mediaci√≥n cultural y otros.",
              "Velar por la integridad y seguridad de las obras y del material recibido a trav√©s del Banco de Contenidos, evitando cualquier uso no autorizado.",
              "En caso de solicitar una obra en archivo digital, respetar la inviolabilidad de las claves de protecci√≥n y bajo ning√∫n concepto duplicar el archivo prestado ni transmitir en ninguna modalidad o formato distinto al indicado en la solicitud.",
              "Incluir la imagen institucional de la REA en el material publicitario, impreso o digital, observando el Manual de Uso y Aplicaci√≥n de Logotipos de la REA.",
              "Informar si se planea cobrar un valor de taquilla por la proyecci√≥n del contenido del Banco de Contenidos, en cuyo caso el ICCA √∫nicamente proveer√° la informaci√≥n de contacto del titular de la obra. El solicitante deber√° tramitar la autorizaci√≥n y negociar√° directamente los t√©rminos para la distribuci√≥n de la taquilla con el titular de la obra. Una vez obtenida la autorizaci√≥n expresa, √©sta debe ser remitida al ICCA para continuar con el debido proceso.",
              "Cumplir con los compromisos asumidos en la carta de compromiso de incorporaci√≥n y en cualquier instrumento complementario derivado de esta.",
            ].map(
              (text) =>
                new Paragraph({
                  text: text,
                  bullet: {
                    level: 0,
                  },
                  spacing: { after: 50 },
                  alignment: AlignmentType.JUSTIFIED,
                }),
            ),
            new Paragraph({
              text: "El miembro de la Red de Espacios Audiovisuales tiene prohibido:",
              spacing: { before: 200, after: 100 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            ...[
              "Cobrar taquilla, donaciones, contribuciones u otros valores por la exhibici√≥n de obras obtenidas a trav√©s del Banco de Contenidos Audiovisuales cuando el titular de los derechos de propiedad intelectual no lo haya autorizado expresamente.",
              "Realizar copias, reproducciones, descargas no autorizadas, duplicaci√≥n o almacenamiento de las obras proporcionadas por el Banco de Contenidos, por fuera del formato y modalidad estrictamente necesarios para su exhibici√≥n autorizada.",
              "Utilizar obras del Banco de Contenidos para fines distintos a los aprobados por el ICCA, incluyendo su uso en festivales, muestras externas, actividades comerciales, plataformas digitales o cualquier evento no autorizado.",
              "Modificar, editar, cortar, alterar o intervenir las obras audiovisuales sin autorizaci√≥n del titular de los derechos.",
              "Facilitar el acceso o prestar materiales del Banco de Contenidos a terceros no autorizados, incluyendo la cesi√≥n de claves, archivos, enlaces o formatos de exhibici√≥n.",
              "Proyectar obras en espacios o sedes no declaradas ante el ICCA, o en condiciones t√©cnicas distintas a las autorizadas que comprometan la calidad o seguridad de la reproducci√≥n, lo que incluye su uso en festivales, muestras externas, actividades comerciales, plataformas digitales o cualquier evento no autorizado.",
              "Divulgar o difundir p√∫blicamente material promocional, informativo o t√©cnico sujeto a confidencialidad o protegido por derechos de autor, salvo autorizaci√≥n del ICCA o del titular correspondiente.",
              "Utilizar la imagen institucional de la REA sin respetar los lineamientos gr√°ficos y comunicacionales autorizados por el ICCA.",
              "Comercializar de manera directa o indirecta cualquier contenido del Banco de Contenidos Audiovisuales.",
            ].map(
              (text) =>
                new Paragraph({
                  text: text,
                  bullet: {
                    level: 0,
                  },
                  spacing: { after: 50 },
                  alignment: AlignmentType.JUSTIFIED,
                }),
            ),
            new Paragraph({
              text: "II. INCUMPLIMIENTO Y CONSECUENCIAS",
              heading: HeadingLevel.HEADING_2,
              spacing: { before: 200, after: 100 },
            }),
            new Paragraph({
              text: "Reconozco que el incumplimiento de obligaciones y de las prohibiciones establecidas en la presente Carta Compromiso ser√° causal de suspensi√≥n o exclusi√≥n definitiva de la REA, que incluye el uso de forma fraudulenta, comercial no autorizada o il√≠cita de los contenidos del Banco de Contenidos Audiovisuales. Dicha exclusi√≥n proceder√° sin perjuicio de las acciones civiles, administrativas o penales que correspondan conforme a la normativa legal vigente de propiedad intelectual o de las sanciones que pueda imponer la autoridad nacional competente en materia de derechos intelectuales.",
              spacing: { after: 200 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            new Paragraph({
              text: "III. ACEPTACI√ìN:",
              heading: HeadingLevel.HEADING_2,
              spacing: { before: 200, after: 100 },
            }),
            new Paragraph({
              text: "Mediante mi aceptaci√≥n me comprometo al cabal cumplimiento de la totalidad de los t√©rminos contenidos en esta Carta Compromiso, asumiendo que mi incumplimiento puede llevar a la suspensi√≥n o exclusi√≥n seg√∫n corresponda, de conformidad con lo establecido en el Reglamento para la operaci√≥n de la Red de Espacios Audiovisuales y del Banco de Contenidos.",
              spacing: { after: 150 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            new Paragraph({
              text: "Adicionalmente, comprendo que el INSTITUTO DE CINE Y CREACI√ìN AUDIOVISUAL (ICCA) no se responsabiliza por las infracciones a la Propiedad Intelectual causadas por quien suscribe.",
              spacing: { after: 300 },
              alignment: AlignmentType.JUSTIFIED,
            }),
            new Paragraph({
              text: "Datos del miembro:",
              heading: HeadingLevel.HEADING_3,
              spacing: { before: 200, after: 100 },
            }),
            new Paragraph({
              children: [
                new TextRun({
                  text: "Administrador del espacio: ",
                  bold: true,
                }),
                new TextRun({ text: space.managerName || "" }),
              ],
              spacing: { after: 50 },
            }),
            new Paragraph({
              children: [
                new TextRun({ text: "Espacio: ", bold: true }),
                new TextRun({ text: space.name || "" }),
              ],
              spacing: { after: 50 },
            }),
            new Paragraph({
              children: [
                new TextRun({ text: "Fecha de aceptaci√≥n: ", bold: true }),
                new TextRun({ text: currentDate }),
              ],
              spacing: { after: 300 },
            }),
            new Paragraph({
              text: "Instituto de Cine y Creaci√≥n Audiovisual (ICCA)",
              alignment: AlignmentType.CENTER,
              spacing: { before: 200, after: 20 },
            }),
            new Paragraph({
              text: "Red de Espacios Audiovisuales (REA)",
              alignment: AlignmentType.CENTER,
            }),
            new Paragraph({
              text: `Vigencia: ${currentDate} - ${twoYearsFromNow.toLocaleDateString("es-EC")}`,
              alignment: AlignmentType.CENTER,
              spacing: { before: 150 },
            }),
          ],
        },
      ],
    })
  }

  const uploadGeneratedAgreement = async () => {
    if (!space) return null

    setIsGeneratingDocument(true)
    try {
      const currentDate = new Date()
      const displayDate = currentDate.toLocaleDateString("es-EC", {
        year: "numeric",
        month: "long",
        day: "numeric",
      })

      const doc = await buildContractDoc(displayDate)
      if (!doc) throw new Error("No se pudo generar el documento")

      const blob = await Packer.toBlob(doc)
      const fileName = `Carta_Compromiso_REA_${space.name.replace(/\s+/g, "_")}_${Date.now()}.docx`

      // Descargar autom√°ticamente el documento
      saveAs(blob, fileName)

      const file = new File([blob], fileName, {
        type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
      })

      const uploaded = await assetService.uploadAsset(
        file,
        AssetTypeEnum.DOCUMENT,
        AssetOwnerEnum.SPACE_DOCUMENT,
        spaceId || undefined,
      )

      setContractDocumentId(uploaded.id)
      setContractDocumentUrl(uploaded.url)

      return uploaded
    } finally {
      setIsGeneratingDocument(false)
    }
  }

  const handleSubmitAgreement = async () => {
    if (!isAccepted) {
      alert("Debes aceptar los t√©rminos para continuar")
      return
    }

    if (!space) {
      alert("No se encontr√≥ la informaci√≥n del espacio")
      return
    }

    try {
      setIsSubmitting(true)

      const uploaded = contractDocumentUrl
        ? { id: contractDocumentId!, url: contractDocumentUrl }
        : await uploadGeneratedAgreement()

      if (!uploaded) {
        throw new Error("No se pudo generar el documento")
      }

      const startDate = new Date()
      const expirationDate = new Date()
      expirationDate.setFullYear(expirationDate.getFullYear() + 2)

      await contractService.createContract({
        adminName: space.managerName,
        spaceId: spaceId!,
        contractType: "space",
        documentUrl: uploaded.url,
        startDate: startDate.toISOString(),
        expirationDate: expirationDate.toISOString(),
      })

      // Actualizar estado del espacio a bajo revisi√≥n
      const { rucDocument, contractId, ...spaceData } = space
      await spaceService.updateSpace(spaceId!, {
        ...spaceData,
        rucDocument: rucDocument || undefined,
        status: SpaceStatus.UNDER_REVIEW,
        ...(contractId !== null && { contractId }),
      })

      setIsCompleted(true)
      alert(
        "¬°Acuerdo aceptado y registrado correctamente! Tu espacio est√° bajo revisi√≥n.",
      )
    } catch (error) {
      console.error("Error al enviar acuerdo:", error)
      alert("Error al enviar el acuerdo. Por favor intenta nuevamente.")
    } finally {
      setIsSubmitting(false)
    }
  }

  if (authLoading || isLoadingSpace) {
    return (
      <div className={styles.container}>
        <div className={styles.loading}>Cargando...</div>
      </div>
    )
  }

  if (!space) {
    return (
      <div className={styles.container}>
        <div className={styles.error}>
          No se pudo cargar la informaci√≥n del espacio
        </div>
      </div>
    )
  }

  return (
    <div className={styles.container}>
      <div className={styles.card}>
        <div className={styles.header}>
          <h1 className={styles.title}>
            üìÑ Carta Compromiso - Red de Espacios Audiovisuales
          </h1>
          <p className={styles.subtitle}>
            √öltimo paso para completar el registro de{" "}
            <strong>{space.name}</strong>
          </p>
        </div>

        <div className={styles.content}>
          <div className={styles.instructions}>
            <h2 className={styles.sectionTitle}>T√©rminos y Condiciones</h2>
            <div className={styles.termsBox}>
              <h3 className={styles.termsTitle}>
                COMPROMISO PARA FORMAR PARTE DE LA RED DE ESPACIOS AUDIOVISUALES
                (REA)
              </h3>

              <h4>I. OBLIGACIONES Y PROHIBICIONES</h4>
              <p>El miembro de la Red de Espacios Audiovisuales se obliga a:</p>
              <ul>
                <li>
                  Remitir los reportes de exhibici√≥n y taquilla √∫nicamente
                  respecto de las funciones realizadas con obras obtenidas a
                  trav√©s del Banco de Contenidos Audiovisuales.
                </li>
                <li>
                  Mantener en funcionamiento el equipamiento t√©cnico utilizado
                  para la exhibici√≥n, garantizando condiciones adecuadas de
                  audio, imagen y seguridad.
                </li>
                <li>
                  Respetar los derechos de autor y conexos, as√≠ como las
                  condiciones de uso y reproducci√≥n de obras provenientes del
                  Banco de Contenidos Audiovisuales.
                </li>
                <li>
                  Permitir visitas t√©cnicas y program√°ticas realizadas por el
                  ICCA, cuando √©stas sean necesarias para verificar el
                  cumplimiento de este Reglamento.
                </li>
                <li>
                  Actualizar la informaci√≥n administrativa y t√©cnica cuando se
                  produzcan cambios o sean solicitados por el ICCA, en la
                  administraci√≥n, equipamiento, funcionamiento o caracter√≠sticas
                  del espacio.
                </li>
                <li>
                  Garantizar accesibilidad para el p√∫blico, conforme a la
                  normativa vigente.
                </li>
                <li>
                  Participar, cuando corresponda, en actividades de formaci√≥n de
                  p√∫blicos, mediaci√≥n cultural y otros.
                </li>
                <li>
                  Velar por la integridad y seguridad de las obras y del
                  material recibido a trav√©s del Banco de Contenidos, evitando
                  cualquier uso no autorizado.
                </li>
                <li>
                  En caso de solicitar una obra en archivo digital, respetar la
                  inviolabilidad de las claves de protecci√≥n y bajo ning√∫n
                  concepto duplicar el archivo prestado ni transmitir en ninguna
                  modalidad o formato distinto al indicado en la solicitud.
                </li>
                <li>
                  Incluir la imagen institucional de la REA en el material
                  publicitario, impreso o digital, observando el Manual de Uso y
                  Aplicaci√≥n de Logotipos de la REA.
                </li>
                <li>
                  Informar si se planea cobrar un valor de taquilla por la
                  proyecci√≥n del contenido del Banco de Contenidos, en cuyo caso
                  el ICCA √∫nicamente proveer√° la informaci√≥n de contacto del
                  titular de la obra. El solicitante deber√° tramitar la
                  autorizaci√≥n y negociar√° directamente los t√©rminos para la
                  distribuci√≥n de la taquilla con el titular de la obra. Una vez
                  obtenida la autorizaci√≥n expresa, √©sta debe ser remitida al
                  ICCA para continuar con el debido proceso.
                </li>
                <li>
                  Cumplir con los compromisos asumidos en la carta de compromiso
                  de incorporaci√≥n y en cualquier instrumento complementario
                  derivado de esta.
                </li>
              </ul>

              <p>
                El miembro de la Red de Espacios Audiovisuales tiene prohibido:
              </p>
              <ol>
                <li>
                  Cobrar taquilla, donaciones, contribuciones u otros valores
                  por la exhibici√≥n de obras obtenidas a trav√©s del Banco de
                  Contenidos Audiovisuales cuando el titular de los derechos de
                  propiedad intelectual no lo haya autorizado expresamente.
                </li>
                <li>
                  Realizar copias, reproducciones, descargas no autorizadas,
                  duplicaci√≥n o almacenamiento de las obras proporcionadas por
                  el Banco de Contenidos, por fuera del formato y modalidad
                  estrictamente necesarios para su exhibici√≥n autorizada.
                </li>
                <li>
                  Utilizar obras del Banco de Contenidos para fines distintos a
                  los aprobados por el ICCA, incluyendo su uso en festivales,
                  muestras externas, actividades comerciales, plataformas
                  digitales o cualquier evento no autorizado.
                </li>
                <li>
                  Modificar, editar, cortar, alterar o intervenir las obras
                  audiovisuales sin autorizaci√≥n del titular de los derechos.
                </li>
                <li>
                  Facilitar el acceso o prestar materiales del Banco de
                  Contenidos a terceros no autorizados, incluyendo la cesi√≥n de
                  claves, archivos, enlaces o formatos de exhibici√≥n.
                </li>
                <li>
                  Proyectar obras en espacios o sedes no declaradas ante el
                  ICCA, o en condiciones t√©cnicas distintas a las autorizadas
                  que comprometan la calidad o seguridad de la reproducci√≥n, lo
                  que incluye su uso en festivales, muestras externas,
                  actividades comerciales, plataformas digitales o cualquier
                  evento no autorizado.
                </li>
                <li>
                  Divulgar o difundir p√∫blicamente material promocional,
                  informativo o t√©cnico sujeto a confidencialidad o protegido
                  por derechos de autor, salvo autorizaci√≥n del ICCA o del
                  titular correspondiente.
                </li>
                <li>
                  Utilizar la imagen institucional de la REA sin respetar los
                  lineamientos gr√°ficos y comunicacionales autorizados por el
                  ICCA.
                </li>
                <li>
                  Comercializar de manera directa o indirecta cualquier
                  contenido del Banco de Contenidos Audiovisuales.
                </li>
              </ol>

              <p>
                El incumplimiento de las prohibiciones establecidas constituir√°
                causal de suspensi√≥n o exclusi√≥n de la Red, sin perjuicio de las
                acciones civiles, administrativas o penales que procedan
                conforme a la normativa vigente de propiedad intelectual.
              </p>

              <h4>II. INCUMPLIMIENTO Y CONSECUENCIAS</h4>
              <p>
                Reconozco que el incumplimiento de obligaciones y de las
                prohibiciones establecidas en la presente Carta Compromiso, ser√°
                causal de suspensi√≥n o exclusi√≥n definitiva de la REA, que
                incluye el uso de forma fraudulenta, comercial no autorizada o
                il√≠cita de los contenidos del Banco de Contenidos Audiovisuales.
                Dicha exclusi√≥n proceder√° sin perjuicio de las acciones civiles,
                administrativas o penales que correspondan conforme a la
                normativa legal vigente de propiedad intelectual o de las
                sanciones que pueda imponer la autoridad nacional competente en
                materia de derechos intelectuales.
              </p>

              <h4>III. ACEPTACI√ìN</h4>
              <p>
                Mediante mi aceptaci√≥n me comprometo al cabal cumplimiento de la
                totalidad de los t√©rminos contenidos en esta Carta Compromiso,
                asumiendo que mi incumplimiento puede llevar a la suspensi√≥n o
                exclusi√≥n seg√∫n corresponda, de conformidad con lo establecido
                en el ‚ÄúReglamento para la operaci√≥n de la Red de Espacios
                Audiovisuales y del Banco de Contenidos‚Äù.
              </p>
              <p>
                Adicionalmente, comprendo que el INSTITUTO DE CINE Y CREACI√ìN
                AUDIOVISUAL (ICCA) no se responsabiliza por las infracciones a
                la Propiedad Intelectual causadas por quien suscribe.
              </p>
            </div>
          </div>

          <div className={styles.acceptanceRow}>
            <label className={styles.checkboxLabel}>
              <input
                type="checkbox"
                checked={isAccepted}
                onChange={(e) => setIsAccepted(e.target.checked)}
              />
              <span>
                Confirmo que he le√≠do y acepto los t√©rminos y condiciones de la
                Carta Compromiso de la REA.
              </span>
            </label>
          </div>

          <div className={styles.submitSection}>
            {isGeneratingDocument && (
              <p className={styles.generatingMessage}>
                ‚è≥ Generando y guardando el documento, por favor espera...
              </p>
            )}
            {!isCompleted && (
              <>
                <Button
                  type="button"
                  variant="primary"
                  onClick={handleSubmitAgreement}
                  disabled={!isAccepted || isSubmitting || isGeneratingDocument}
                  className={styles.submitButton}
                >
                  {isSubmitting ? "Enviando..." : "‚úì Aceptar y Continuar"}
                </Button>
                <p className={styles.note}>
                  Al aceptar, generaremos autom√°ticamente la carta compromiso
                  con los datos del espacio, la guardaremos en el sistema y
                  podr√° descargarla como respaldo.
                </p>
              </>
            )}
            {isCompleted && (
              <div className={styles.completedMessage}>
                <p className={styles.successMessage}>
                  ‚úì ¬°Acuerdo aceptado y registrado correctamente!
                </p>
                <p className={styles.note}>
                  Tu espacio est√° ahora bajo revisi√≥n y ser√° evaluado por el
                  equipo del ICCA.
                </p>
                <Button
                  type="button"
                  variant="secondary"
                  onClick={() => router.push("/home")}
                  className={styles.continueButton}
                >
                  Ir al home
                </Button>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}
